戦闘要素を追加したいです。
要件は以下です。
・相手のキャラクターが扇形のエリア内に入った場合、その扇形のトリガーで攻撃を行う。
・相手のキャラクターのトリガーの扇形の中に味方のキャラクターが入った場合、攻撃を受けます。
・同時に行動をするため、場合によっては相打ちとしてどちらも同時に攻撃を受けます。
・攻撃を仕掛けてきたキャラクターに対して、攻撃を受けるキャラクターのトリガーの方向が向いていた場合、回避or防御が発生します。
・攻撃を仕掛けてきたキャラクターに対して、攻撃を受けるキャラクターのトリガーが向いていなかった場合、防御や回避は発生せずに撃破されます。
・HPに該当する数値は、「キャラクターのtrion値×キャラクターのdefence値×攻撃者に向いているトリガーのdefense値」　になります
・攻撃が当たったとき、「攻撃者のキャラクターのattack値×攻撃者のキャラクターtrion値×扇形に入ったトリガーのtrionEffect値」によってダメージが決まり、攻撃を受けたキャラクターのHPが減ります
・攻撃される側のトリガーの扇形が攻撃者を向いていた場合、「攻撃されるのキャラクターのavoid値×攻撃されるキャラクターの扇形に入ったトリガーのavoid値」のパーセントの確率で回避が発生します。
・攻撃を行うと1秒間動きが止まります。1秒後に設定した動きの続きを行います。
・防御を行うと1秒間動きが止まります。1秒後に設定した動きの続きを行います。
・動きが止まっている間に攻撃を受けた場合、その分止まる秒数も長くなります。
・行動ごとにHPは回復します。


トリガーの扇形についての注意点
・攻撃は扇形のエリアの中に相手のキャラクターが入ったときに自動で実行されます
・防御や回避は扇形が攻撃者に向いていれば自動で実行されます

撃破されるパターンは以下のいずれかになります
・行動と行動の間の、動きが止まっている間にHPを超えるダメージを受けた
・一撃でHPを超えるダメージを受けた
・攻撃を受ける側のトリガーの扇形の向きが攻撃するキャラクターを向いていなかった


# 戦闘システム実装完了

## 実装された機能

### 1. 戦闘システムクラス (CombatSystem.ts)
- **自動戦闘判定**: キャラクターが敵のトリガー扇形に入った際の自動攻撃実行
- **HP計算**: キャラクターのtrion値×defense値×トリガーdefense値
- **ダメージ計算**: 攻撃者のattack値×trion値×トリガーtrionEffect値
- **回避判定**: 防御側のavoid値×トリガーavoid値の確率で回避
- **スタン効果**: 攻撃・防御時に1秒間の行動停止
- **HP回復**: アクションごとに最大HPの10%回復
- **撃破判定**: HPが0以下になった際の自動撃破処理

### 2. 戦闘ルール
#### 攻撃条件
- 相手キャラクターが自分のトリガー扇形エリア内に入る
- 扇形は60度、半径3ヘックス
- メイン・サブトリガー両方で攻撃可能

#### 防御・回避条件
- 攻撃者に向けてトリガー扇形が設定されている
- 回避確率 = 防御側avoid値 × トリガーavoid値 (%)
- 防御時はダメージ軽減あり

#### 撃破条件
1. 一撃でHPを超えるダメージを受けた
2. スタン中にHPを超えるダメージを受けた  
3. トリガーが攻撃者を向いていない状態で攻撃を受けた

### 3. 視覚効果
- **ダメージ表示**: 赤文字でダメージ数値を表示
- **回避表示**: 緑文字で「AVOID」を表示
- **攻撃エフェクト**: 攻撃ラインと爆発エフェクト
- **HPバー**: キャラクター上部に動的HPバー
- **スタン効果**: グレーアウト表示

## 使用方法

### GameGrid.tsx内での統合
```typescript
// 戦闘システム初期化
private initializeCombatSystem() {
  this.combatSystem = new CombatSystem(/*...*/);
  // 全キャラクターの戦闘ステータスを初期化
}

// アクション完了時の戦闘チェック
private completeActionPhase() {
  this.combatSystem.checkCombatTriggers();
  // HPバー更新、HP回復など
}
```

### キャラクターステータス (status.ts)
```typescript
CHARACTER_STATUS = {
  MIKUMO_OSAMU: {
    trion: 2,        // トリオン値
    attack: 3,       // 攻撃力
    defense: 4,      // 防御力  
    avoid: 4,        // 回避力
    main: "ASTEROID", // メイントリガー
    sub: "RAYGUST"   // サブトリガー
  }
}

TRIGGER_STATUS = {
  ASTEROID: {
    attack: 4,       // トリガー攻撃力
    defense: 0,      // トリガー防御力
    avoid: 10,       // トリガー回避力
    trionEffect: 1   // トリオン効果倍率
  }
}
```

## 戦闘フロー

1. **移動フェーズ**: キャラクターが移動
2. **戦闘判定**: 敵のトリガー範囲に入ったキャラクターを検出
3. **攻撃実行**: 
   - ダメージ計算
   - 回避判定
   - スタン適用
4. **結果表示**: エフェクトとダメージ表示
5. **HP回復**: 生存キャラクターのHP回復
6. **次ターン**: 設定モードに戻る

## 今後の拡張予定
- より詳細な戦闘アニメーション
- トリガーごとの個別エフェクト
- 戦闘ログの詳細化
- スキルやアビリティシステム

戦闘システムの実装が完了し、ゲームプレイ中に自動的に戦闘が発生するようになりました。
